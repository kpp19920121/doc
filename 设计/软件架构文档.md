#软件架构设计

版本<0>

修订历史记录

|日期|版本|修订说明|作者|
|:-|:-|:-|:-|
|2018-04-27|0|提供基本的格式|刘知峻|


## 1. 引言
### 1.1 编写目的
### 1.2 适用范围
### 1.3 定义
### 1.4 参考资料
### 1.5 概述

## 2. 目前的软件系统架构

## 3. 软件系统架构设计目标

## 4. 建议的软件系统架构

### 4.1 概述

### 4.2 用例视图

### 4.3 系统逻辑视图
#### 4.3.1 子系统分解

子系统划分为六大部分，其中各个子系统的功能说明如下：

|子系统名称|功能|提供服务|接口形式|
|:-|:-|:-|:-|
|UISubsystem|提供用户界面和用户界面控制包含了许多相对独立的ViewModels|-|-|
|EntitySubsystem|提供所有的实体对象的访问功能，进行对网络服务和本地数据库服务的封装。包含了所有的实体类，和实体类管理器，提供各种高级功能，比如点赞，评论，下载等。UI不需要了解更深层次的细节即可使用相关的网络功能。|和UISubsystem强耦合|Java|
|LocalStorageSubSystem|提供本地数据库访问|LocalStorage|Java|
|CommunicationSubSystem|提供对服务器的web接口的访问，属于通信子系统，向Entity提供网路通信服务，是EntitySubsystem获取网络服务的桥梁，将Server提供的复杂web接口转换为简单的Http接口。该子系统同时存在于Android客户端和服务器结点上。|CommunicationService|Java|
|SensorSubSystem|提供对处理过的传感器数据访问的子系统，通过访问传感器接口，客户能够接收到传感器提供的各种高级信息，包括经纬度，高度，速度，方向，加速等|SensorAccess|Java|
|ServerSubSystem|提供在线数据存储服务，是所有客户端的数据仓库。该子系统处理上传和下载文件、用户登陆的功能背后的数据库请求服务，同时也承担处理用户上传VSS和下载VSS的责任。|WebAccess|HTTP - json|
|SensorHardwareWrapper|传感器硬件封装系统|封装了各种传感器原始信息的获取工作，单独运行在一个线程中。一旦传感器连接，便开始自动运行。|Java|

![SubsystemDecomposition](./Diagrams/SubsystemDecomposition.svg)

```PlantUML
@startuml Diagrams/SubsystemDecomposition
skinparam componentStyle uml2

interface "WebAccess" as WA
interface "CommnicationService" as CI
interface "LocalStorage" as LS
interface "SensorAccess" as SA
interface "RawSensorDataAccess" as BC
interface "LocalVSSService" as ML
interface "OnlineVSSService" as MO

[ServerSubsystem] -up- WA
[CommunicationSubsystem] -up- CI
[LocalStorageSubsystem] -up- LS
[EntitySubsystem]
[SensorSubsystem] -up- SA
[UISubsystem]
[EntitySubsystem] -up- ML
[EntitySubsystem] -up- MO

[CommunicationSubsystem] .down.> WA
[EntitySubsystem] ..> LS
[EntitySubsystem] .right.> CI
[UISubsystem] ..> SA
[UISubsystem] ..> ML
[UISubsystem] ..> MO
[SensorHardwareWrapper] -up- BC
[SensorSubsystem] ..> BC
@enduml
```
#### 4.3.2 子系统综述

##### UISubsystem

###### 子系统接口定义
UISubsystem不提供接口

###### 类图
TODO("类图暂时留到设计的最后，因为变动会很大，先维护一个")

##### EntitySubsystem
###### 子系统接口定义
###### 类图


##### SensorSubsystem

###### 子系统接口定义

* SensorAccess

|Signature|Description|
|:-|:-|
|Position getCurrentLocation()|returns the latest updated position calculated fron sensor data.|
|boolean isSensorOnline() |returns the status of sensor, which can be offline and online.|
|void callWhenUpdated(Callable task)|give sensor a task object for it to call its this.run() method in another thread when an update of position is avaliable.|
|void callWhenUpdatedDelay(int millisecond)|the overload version of the above function only that this will not call callback function until assigned milliseconds has passed.|
|Quaternion getHeadPose()|returns a Quaternion describing the position of the user's head.|
|void clearTask()|remove all the tasks that are running. Notice that if the sensor goes offline, the Sensor class can not return to normal state but will stuck at the same Location and Pose.|

###### 类图
Additional Analysis Objects

|Type Name|Definition|
|:-|:-|
|Callable|A interface that has a method run(), which can be called.|
|Quaternion|A class containing four float numbers. Describes the position of the user's head.|
|Position|A class containing the x, y and z position of user's head in the absolute coordinate of capmus.|

|New Concepts|Explanation|
|:-|:-|
|Coordinate of Campus|the absolute coordinate that is stuck on the campus ground, detailed definition will be given during implementation.|
|||


##### LocalStorageSubsystem
###### 子系统接口定义
###### 类图



##### CommunicationSubsystem
###### 子系统接口定义
###### 类图

实现阶段可能会添加更多的类

##### ServerSubsystem
###### 子系统接口定义
###### 类图

##### SensorHardwareWrapper

***该部分技术难度较高，推迟到相应的实现阶段进行***

###### 子系统接口定义
###### 类图

对该子系统的描述推迟到实现阶段进行

#### 4.3.3 用例实现
参见顺序图

#### 4.3.4 子系统协作


### 4.4 系统运行视图

总体上使用Android提供的多线程框架和事件系统进行实现。
ServerSubsystem通过Flask自带的服务器实现多线程处理。

此外SensorSubsystemWrapper和SensorSubsystem分别运行在单独的线程上。而不是运行在Android主线程上。



### 4.5 系统实现视图

### 4.6 系统物理视图


![DeploymentDiagram](./Diagrams/DeploymentDiagram.svg)

```PlantUML
@startuml Diagrams/DeploymentDiagram
skinparam componentStyle uml2

node ClientPhone <<device>> {
    component UISubsystem
    component SensorSubsystem
    component CommunicationSubsystem
    component LocalStorageSubsystem
    component EntitySubsystem
    component SensorHardwareWrapper
    SensorSubsystem ..> SensorHardwareWrapper
    UISubsystem ..> EntitySubsystem
    EntitySubsystem ..> LocalStorageSubsystem
    EntitySubsystem ..> CommunicationSubsystem
    UISubsystem ..> SensorSubsystem
}

node ServerComputer <<server>> {
    component ServerSubsystem
}

CommunicationSubsystem ..> ServerSubsystem: Http

node WirelessSensor <<device>>

WirelessSensor <.. SensorHardwareWrapper

@enduml
```
### 4.7 数据管理设计

### 4.8 其他设计
