#软件架构设计

修订历史记录
|日期|版本|修订说明|作者|
|:-|:-|:-|:-|
|2018-04-27|0|提供基本的格式|刘知峻|


## 1. 引言
### 1.1 编写目的
### 1.2 适用范围
### 1.3 定义
### 1.4 参考资料
### 1.5 概述

## 2. 目前的软件系统架构

## 3. 软件系统架构设计目标

## 4. 建议的软件系统架构

### 4.1 概述

### 4.2 用例视图

### 4.3 系统逻辑视图
#### 4.3.1 子系统分解

子系统划分为六大部分，其中各个子系统的功能说明如下：
|子系统名称|功能|提供服务|接口形式|
|:-|:-|:-|:-|
|UISubsystem|提供用户界面和用户界面控制包含了许多相对独立的ViewModels|-|-|
|EntitySubsystem|提供所有的实体对象的访问功能，进行对网络服务和本地数据库服务的封装。包含了所有的实体类，和实体类管理器，提供各种高级功能，比如点赞，评论，下载等。UI不需要了解更深层次的细节即可使用相关的网络功能。|和UISubsystem强耦合|Java|
|LocalStorageSubSystem|提供本地数据库访问|LocalStorage|Java|
|CommunicationSubSystem|提供对服务器的web接口的访问，属于通信子系统，向Entity提供网路通信服务，是EntitySubsystem获取网络服务的桥梁，将Server提供的复杂web接口转换为简单的Http接口。该子系统同时存在于Android客户端和服务器结点上。|CommunicationService|Java|
|SensorSubSystem|提供对处理过的传感器数据访问的子系统，通过访问传感器接口，客户能够接收到传感器提供的各种高级信息，包括经纬度，高度，速度，方向，加速等|SensorAccess|Java|
|ServerSubSystem|提供在线数据存储服务，是所有客户端的数据仓库。该子系统处理上传和下载文件、用户登陆的功能背后的数据库请求服务，同时也承担处理用户上传VSS和下载VSS的责任。|WebAccess|HTTP - json|
|SensorHardwareWrapper|传感器硬件封装系统|封装了各种传感器原始信息的获取工作，单独运行在一个线程中。一旦传感器连接，便开始自动运行。|Java|

![SubsystemDecomposition](./Diagrams/SubsystemDecomposition.svg)
```PlantUML
@startuml Diagrams/SubsystemDecomposition
skinparam componentStyle uml2

interface "WebAccess" as WA
interface "CommnicationService" as CI
interface "LocalStorage" as LS
interface "SensorAccess" as SA
interface "RawSensorDataAccess" as BC

[ServerSubsystem] -up- WA
[CommunicationSubsystem] -up- CI
[LocalStorageSubsystem] -up- LS
[EntitySubsystem]
[SensorSubsystem] -up- SA
[UISubsystem]

[CommunicationSubsystem] .down.> WA
[EntitySubsystem] ..> LS
[EntitySubsystem] .right.> CI
[UISubsystem] ..> SA
[UISubsystem] ..> [EntitySubsystem]
[SensorHardwareWrapper] -down- BC
[SensorSubsystem] ..> BC
@enduml
```
#### 4.3.2 子系统综述

##### UISubsystem
##### EntitySubsystem
##### SensorSubsystem
##### LocalStorageSubsystem



##### CommunicationSubsystem

实现阶段可能会添加更多的类

##### ServerSubsystem

##### SensorHardwareWrapper

对该子系统的描述推迟到实现阶段进行

### 4.4 系统运行视图
总体上使用Android提供的多线程框架和事件系统进行实现。
ServerSubsystem通过Flask自带的服务器实现多线程处理。

此外SensorSubsystemWrapper和SensorSubsystem分别运行在单独的线程上。而不是运行在Android主线程上。



### 4.5 系统实现视图

### 4.6 系统物理视图


![DeploymentDiagram](./Diagrams/DeploymentDiagram.svg)
```PlantUML
@startuml Diagrams/DeploymentDiagram
skinparam componentStyle uml2

node ClientPhone <<device>> {
    component UISubsystem
    component SensorSubsystem
    component CommunicationSubsystem
    component LocalStorageSubsystem
    component EntitySubsystem
    component SensorHardwareWrapper
    SensorSubsystem ..> SensorHardwareWrapper
    UISubsystem ..> EntitySubsystem
    EntitySubsystem ..> LocalStorageSubsystem
    EntitySubsystem ..> CommunicationSubsystem
    UISubsystem ..> SensorSubsystem
}

node ServerComputer <<server>> {
    component ServerSubsystem
}

CommunicationSubsystem ..> ServerSubsystem: Http

node WirelessSensor <<device>>

WirelessSensor <.. SensorHardwareWrapper

@enduml
```
### 4.7 数据管理设计

### 4.8 其他设计
