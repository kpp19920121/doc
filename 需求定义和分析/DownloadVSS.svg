<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="634px" preserveAspectRatio="none" style="width:1671px;height:634px;" version="1.1" viewBox="0 0 1671 634"
    width="1671px" zoomAndPan="magnify"><defs><filter height="300%" id="f5fvi8w82870o" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FEFECE" filter="url(#f5fvi8w82870o)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="209" x="628" y="263.041"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="195" x="635" y="283.5762">cloneVSS:VirtualSoundSpace</text><line style="stroke: #000000; stroke-width: 1.0;" x1="635" x2="830" y1="285.5762" y2="285.5762"/><rect fill="#FFFFFF" filter="url(#f5fvi8w82870o)" height="151.5078" style="stroke: #000000; stroke-width: 2.0;" width="1052.5" x="608" y="454.082"/><rect fill="#FFFFFF" filter="url(#f5fvi8w82870o)" height="90.8867" style="stroke: #000000; stroke-width: 2.0;" width="516.5" x="618" y="507.7031"/><rect fill="#FFFFFF" height="44.2656" style="stroke: none; stroke-width: 1.0;" width="516.5" x="618" y="554.3242"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="26" x2="26" y1="86.4883" y2="622.5898"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="141" x2="141" y1="86.4883" y2="622.5898"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="334" x2="334" y1="86.4883" y2="622.5898"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="526" x2="526" y1="86.4883" y2="622.5898"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="734" x2="734" y1="295.7852" y2="622.5898"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1030.5" x2="1030.5" y1="86.4883" y2="622.5898"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="31" x="8" y="83.5352">User</text><line style="stroke: #000000; stroke-width: 1.0;" x1="8" x2="39" y1="85.5352" y2="85.5352"/><ellipse cx="26.5" cy="13" fill="#FEFECE" filter="url(#f5fvi8w82870o)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M26.5,21 L26.5,48 M13.5,29 L39.5,29 M26.5,48 L13.5,63 M26.5,48 L39.5,63 " fill="none" filter="url(#f5fvi8w82870o)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f5fvi8w82870o)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="169" x="55" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="155" x="62" y="71.5352">:PreviewOnline***Page</text><line style="stroke: #000000; stroke-width: 1.0;" x1="62" x2="217" y1="73.5352" y2="73.5352"/><rect fill="#FEFECE" filter="url(#f5fvi8w82870o)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="188" x="238" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="174" x="245" y="71.5352">:PreviewOnline***Control</text><line style="stroke: #000000; stroke-width: 1.0;" x1="245" x2="419" y1="73.5352" y2="73.5352"/><rect fill="#FEFECE" filter="url(#f5fvi8w82870o)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="168" x="440" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="154" x="447" y="71.5352">vss:VirtualSoundSpace</text><line style="stroke: #000000; stroke-width: 1.0;" x1="447" x2="601" y1="73.5352" y2="73.5352"/><rect fill="#FEFECE" filter="url(#f5fvi8w82870o)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="184" x="936.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="170" x="943.5" y="71.5352">:LocalSoundSpaceLibrary</text><line style="stroke: #000000; stroke-width: 1.0;" x1="943.5" x2="1113.5" y1="73.5352" y2="73.5352"/><polygon fill="#A80036" points="129.5,113.4883,139.5,117.4883,129.5,121.4883,133.5,117.4883" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="26.5" x2="135.5" y1="117.4883" y2="117.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="33.5" y="113.0566">downloadVSS</text><path d="M531,130.7988 L531,155.7988 L1184,155.7988 L1184,140.7988 L1174,130.7988 L531,130.7988 " fill="#FBFB77" filter="url(#f5fvi8w82870o)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1174,130.7988 L1174,140.7988 L1184,140.7988 L1174,130.7988 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="632" x="537" y="148.3672">download operation downloads every SoundSource's SoundFragment, a separate local VSS is created.</text><path d="M531,170.1094 L531,195.1094 L945,195.1094 L945,180.1094 L935,170.1094 L531,170.1094 " fill="#FBFB77" filter="url(#f5fvi8w82870o)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M935,170.1094 L935,180.1094 L945,180.1094 L935,170.1094 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="393" x="537" y="187.6777">every SoundFragment is identified uniquely by MD5 of the file.</text><polygon fill="#A80036" points="322,221.4199,332,225.4199,322,229.4199,326,225.4199" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="141.5" x2="328" y1="225.4199" y2="225.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="148.5" y="220.9883">downloadVSS</text><polygon fill="#A80036" points="514,250.7305,524,254.7305,514,258.7305,518,254.7305" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="334" x2="520" y1="254.7305" y2="254.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="341" y="250.2988">download</text><polygon fill="#A80036" points="616,280.041,626,284.041,616,288.041,620,284.041" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="526" x2="622" y1="284.041" y2="284.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="533" y="279.6094">&lt;&lt;create&gt;&gt;</text><rect fill="#FEFECE" filter="url(#f5fvi8w82870o)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="209" x="628" y="263.041"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="195" x="635" y="283.5762">cloneVSS:VirtualSoundSpace</text><line style="stroke: #000000; stroke-width: 1.0;" x1="635" x2="830" y1="285.5762" y2="285.5762"/><polygon fill="#A80036" points="722.5,345.8398,732.5,349.8398,722.5,353.8398,726.5,349.8398" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="526" x2="728.5" y1="349.8398" y2="349.8398"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="533" y="345.4082">copyMetaDataFrom(vss)</text><path d="M739,313.5293 L739,368.5293 L1199,368.5293 L1199,323.5293 L1189,313.5293 L739,313.5293 " fill="#FBFB77" filter="url(#f5fvi8w82870o)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1189,313.5293 L1189,323.5293 L1199,323.5293 L1189,313.5293 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="394" x="745" y="331.0977">MetaData stands for all forms of data only that a VSS contains,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="309" x="745" y="346.4082">including SS, SF, but the SFs are not downloaded.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="439" x="745" y="361.7188">notice that we copy the references for SoundSources, it should be OK.</text><polygon fill="#A80036" points="1018.5,395.4609,1028.5,399.4609,1018.5,403.4609,1022.5,399.4609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="526" x2="1024.5" y1="399.4609" y2="399.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="533" y="395.0293">addSoundSpace(cloneVSS)</text><polygon fill="#A80036" points="722.5,429.7715,732.5,433.7715,722.5,437.7715,726.5,433.7715" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="526" x2="728.5" y1="433.7715" y2="433.7715"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="533" y="429.3398">downloadAll</text><path d="M739,412.7715 L739,437.7715 L1243,437.7715 L1243,422.7715 L1233,412.7715 L739,412.7715 " fill="#FBFB77" filter="url(#f5fvi8w82870o)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1233,412.7715 L1233,422.7715 L1243,422.7715 L1233,412.7715 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="483" x="745" y="430.3398">downloadAll makes cloneVSS to attempt to download all its SoundFragments</text><path d="M608,454.082 L682,454.082 L682,461.082 L672,471.082 L608,471.082 L608,454.082 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="151.5078" style="stroke: #000000; stroke-width: 2.0;" width="1052.5" x="608" y="454.082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="623" y="467.6504">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="213" x="697" y="466.7168">[for each soundFragment in cloneVSS]</text><polygon fill="#A80036" points="1018.5,488.3926,1028.5,492.3926,1018.5,496.3926,1022.5,492.3926" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="734.5" x2="1024.5" y1="492.3926" y2="492.3926"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="741.5" y="487.9609">checkSoundFragmentExist(soundFragment)</text><path d="M618,507.7031 L680,507.7031 L680,514.7031 L670,524.7031 L618,524.7031 L618,507.7031 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="90.8867" style="stroke: #000000; stroke-width: 2.0;" width="516.5" x="618" y="507.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="633" y="521.2715">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="34" x="695" y="520.3379">[exist]</text><path d="M1139.5,512.7031 L1139.5,537.7031 L1641.5,537.7031 L1641.5,522.7031 L1631.5,512.7031 L1139.5,512.7031 " fill="#FBFB77" filter="url(#f5fvi8w82870o)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1631.5,512.7031 L1631.5,522.7031 L1641.5,522.7031 L1631.5,512.7031 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="481" x="1145.5" y="530.2715">because we want to have simpler data structure, we got complex procedures</text><polygon fill="#A80036" points="745.5,542.0137,735.5,546.0137,745.5,550.0137,741.5,546.0137" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="739.5" x2="1029.5" y1="546.0137" y2="546.0137"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="751.5" y="541.582">sameDownloadedSoundFragment</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="618" x2="1134.5" y1="555.3242" y2="555.3242"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="55" x="623" y="565.959">[nonexist]</text><polygon fill="#A80036" points="745.5,586.2793,735.5,590.2793,745.5,594.2793,741.5,590.2793" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="739.5" x2="1029.5" y1="590.2793" y2="590.2793"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="751.5" y="585.8477">null</text><!--
@startuml DownloadVSS
hide footbox
skinparam sequenceParticipant underline
actor User as user
participant ":PreviewOnline***Page" as page
participant ":PreviewOnline***Control" as control
participant "vss:VirtualSoundSpace" as vss
participant "cloneVSS:VirtualSoundSpace" as clone
participant ":LocalSoundSpaceLibrary" as library
user -> page: downloadVSS
note right of vss: download operation downloads every SoundSource's SoundFragment, a separate local VSS is created.
note right of vss: every SoundFragment is identified uniquely by MD5 of the file.
page -> control: downloadVSS
control -> vss: download
create clone
vss -> clone: <<create>>
vss -> clone: copyMetaDataFrom(vss)
note right
MetaData stands for all forms of data only that a VSS contains,
including SS, SF, but the SFs are not downloaded.
notice that we copy the references for SoundSources, it should be OK.
end note
vss -> library: addSoundSpace(cloneVSS)
vss -> clone: downloadAll
note right
downloadAll makes cloneVSS to attempt to download all its SoundFragments
end note
loop for each soundFragment in cloneVSS
    clone -> library: checkSoundFragmentExist(soundFragment)
    alt exist
        library -> clone: sameDownloadedSoundFragment
    else nonexist
        library -> clone: null
    end
    note right
        because we want to have simpler data structure, we got complex procedures
    end note
end



@enduml

PlantUML version 1.2018.01(Mon Jan 29 02:08:22 CST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 9+181
Operating System: Mac OS X
OS Version: 10.12.6
Default Encoding: UTF-8
Language: zh
Country: CN
--></g></svg>