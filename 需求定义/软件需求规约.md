# AudioAR项目 软件需求规约
版本 <2>
修订历史
[@文档commit历史](https://github.com/AudioAR/doc/commits/master/%E8%AE%A1%E5%88%92/%E5%8F%AF%E8%A1%8C%E6%80%A7%E7%A0%94%E7%A9%B6%E6%8A%A5%E5%91%8A.md)

|日期|版本|修订说明|作者|
|:-:|:-:|:-|:-|
|2018-04-10|0|建立模版|丁雨晨|
|2018-04-13|1|按照模板填充系统要求|丁雨晨|
|2018-04-15|2|完善3.1-3.3部分|缪本杰|
|2018-04-16|2|完善系统模型|丁雨晨|
## 1引言
### 1.1编写目的
拟定软件需求规约，初步确定软件总体的需求和目标。这是为了确定项目总体实施框架，细化量化用户可能的需求，为软件设计和实现指明方向。本规约同时也限定了软件开发的适用范围和禁区，避免随之而来的不利后果，增强项目开发的针对性和合理性。此文档不仅面向软件开发者，还为项目审核人员及用户提供参考。在设计和实现中如遇到特殊情况，将完全有可能修改此文档，因此仅有本文档的最新版本具有参考价值。

### 1.2适用范围
此文档适用于AudioAR项目的全部软件及系统，将从总体上限定项目的开发目标和框架。

### 1.3定义
相关定义见词汇表[@doc/需求定义/词汇表.md](https://github.com/AudioAR/doc/blob/master/%E9%9C%80%E6%B1%82%E5%AE%9A%E4%B9%89/%E8%AF%8D%E6%B1%87%E8%A1%A8.md)


### 1.4参考资料
- Object-oriented Software Engineering Using UML, Patterns, and Java
- 《软件工程实践指南》 曹健 上海交通大学出版社
- 《软件需求规约模板》 曹健

### 1.5概述
为了满足用户对于现实生活中的声音在虚拟空间中重现的需求，本产品应当完成对用户位置信息的获取、声音资源的输入输出、立体声场的构建和其他和用户的交互功能。
为此，不仅仅需要重现现实固有的声音资源，还有能够任意地产生需要的声场，这将是对软件实用性的综合考验。本文档将从顶层视角大致规定软件的开发需求，将从已有系统的概况、希望完成的改进系统的功能与非功能需求、以及目标系统应当可以实现的应用场景和用例模型这些方面进行介绍。本文档将需要以用户视角为主要视角来叙述，力求满足在将来应用中对用户的友好和对用户需求的友好。

## 2目前系统
行业目前不存在工作目标相同的现有系统，仅存在处于原型阶段或功能有一定重叠的系统，下面做简要介绍：
虚拟音频是近几年VR产业的研究热点，基于音频与位置传感相结合，用于提供娱乐体验的系统尚未有先例。但有市场上各种产品提供了部分类似的功能，下面分析其中几款具有强关联性的产品：

-   [Google AR](https://developers.google.com/ar/discover/concepts)
    -   Google ARCore 提供了AR开发的基本功能：运动跟踪、光学环境理解、光估测、可跟踪对象
    -   ARCore 基于特别的校准过的高性能惯性传感器，这些传感器被安装在屈指可数的Android 平台手机中，因此目前开发前景有限
    -   从AR方面来讲，该系统成本过高，没有考虑音频方面的处理。实时利用摄像机数据进行计算的算法复杂度高，但仍然存在不稳定，条件苛刻的问题
    
-   [IndoorAtlas](http://www.indooratlas.com)
    -   IndoorAtlas 提供了室内地磁定位的基本功能
    -   其地磁定位服务能够达到2m左右的精度，高于我们的设计目标。提高精度的难度是很大的。
    -   IndoorAtlas 不提供带来更广应用空间的室外定位技术，同时不考虑惯性传感器进行的优化。
    
-   [Bose AR (this link to a relevant news)](http://www.sohu.com/a/226893286_104421)
    -  简介：Bose 作为传统耳机公司，在18年3月份宣布进军音频AR产业。Bose正在与ASICS Studio、Strava、TripAdvisor、TuneIn和Yelp等公司合作开发体验或更新现有平台。Bose推出的产品是AR智能眼镜，该产品的定位和我们的产品定位惊人地相似。该产品仍处在概念阶段
    -  数据处理流程：这款眼镜能通过蓝牙与iPhone或Android设备的GPS连接来判断位置，然后将采集的数据发送到新推出的Bose AR平台上，之后该应用再向用户返回相关的音频内容
    -  人员：该产品的开发成本预计会更低，并且由于Bose强大的生态圈，会吸引众多的内容提供者
    -  设备：该产品利用GPS定位，仍然没有结合其他的定位技术，会造成该产品室内定位得不到保证，同时位置稳定性难以得到保证
    -  费用开支：预计这样的一套智能眼镜设备价格在1000元以上，比较昂贵。
## 3建议的系统
### 3.1概述
本系统的名称为AudioAR。其设计的初衷是为了满足用户__对于现实生活中的声音在虚拟空间中重现__的需求。技术栈结构参见 @doc/team_project_proposal.md#技术原理与功能设计 经过实验验证和相关调查，将要构建的系统能够满足低成本、易推广、基本具有实时性等要求。
### 3.2功能需求
#### 3.2.1用户管理
    用户登陆、注销、注册、设置个人信息
#### 3.2.2声音库管理
    允许用户上传、下载、查看私有与公有的声音资源文件，并将这些文件用于构建、浏览虚拟声音空间
#### 3.2.3虚拟声音空间管理
    允许用户构建、修改在交通大学闵行校区内的虚拟声音空间，声音具有立体位置、一定的触发条件、一定的播放方式
#### 3.2.4立体音频流生成
    进行实时立体声音生成，通过耳机传递给用户，产生逼真的空间声音效果
#### 3.2.5空间音频图像化
    给用户提供一定的图像反馈，形式包括地图、声音定位罗盘等
#### 3.2.6基于空间立体音频的二次应用
    用户可以通过空间立体音频来进行单人、多人的游戏

### 3.3非功能需求
#### 3.3.1可用性
-   良好的实时性，实时生成的音频流不具有明显的卡顿
-   声音的真实性，音频流与真实的立体声音难以区分
#### 3.3.2可靠性
-   在软件设计要求的运行环境内可以长时间、无差错、少维护地工作，减少软件框架或主要内容大量修改的可能性
#### 3.3.3性能
-   一般的精度，处理传感器数据生成的位置信息具有水平5m左右，垂直20cm左右的精确度；头部运动捕捉比较准确
-   实时的信息处理交互，使用户可以真实感受声音的播发而无明显卡顿、滞后
#### 3.3.4可支持性
-   可扩展的吞吐量和服务提供能力，服务器能稳定提供几名用户的资源请求和相关通讯
#### 3.3.5设计约束
-   使用MVVM设计模式：利用数据绑定改进的MVP架构，项目中特指利用Android数据绑定库完成的MVVM
-   使用Java语言，在安卓平台上进行项目开发。[@Java编码风格指南](https://github.com/AudioAR/doc/blob/master/%E6%9E%84%E9%80%A0/Java%E7%BC%96%E7%A0%81%E9%A3%8E%E6%A0%BC%E6%8C%87%E5%8D%97)
-  传感器使用 ***维特智能*9轴姿态角度传感器** 型号：JY901 [@公司官网](www.wit-motion.com)
#### 3.3.6 接口
##### 3.3.6.1用户界面
在用户端，用户界面的功能主要为给用户提供必要的流程提示和可视化场景，辅以用户与系统的交互。主要需要实现的内容有：
-   登录菜单
-   主界面
    -   虚拟场景设置
    -   开始体验按钮
    -   收听提示
    -   可视化声音指示（地图，声音罗盘）
-   管理界面
    -   音频库管理
    -   用户管理
    -   音频库分享
-   其他
    -   系统设置
    -   开发人员信息
    -   版权信息
用户界面以简约为风格。
##### 3.3.6.2 硬件接口
使用***维特智能*9轴姿态角度传感器**，[@产品简介](http://www.wit-motion.com/index.php?m=goods&a=details&content_id=43)。
-    传感器测量值转化为TTL电平传输到本机。
-    **具体信号编码见传感器说明书**
    **相关参数**
-    波特率：2400、4800、9600(默认)、19200、38400、57600、115200、230400、460800、921600
-    停止位 1，校验位 0
##### 3.3.6.3 软件接口
本项目目前主要用到了以下开发包
-  Google VR 安卓
    该开发包主要用来根据传入的位置参数产生空间音源
- 百度地图
    该开发包主要完成地图功能

-   -   实时处理流程: 传感器数据 \ 音频流 -> 位置估计过程 -> 音频流生成过程 -> 耳机输出
-   数据交互流程: 用户申请文件传输 -> web API -> 服务器找到文件并验证身份 -> 服务器发送文件 -> 用户接收并保存文件和信息
##### 3.3.6.4通信接口
使用HTTP接口来实现本机到服务器端的通信。
#### 3.3.7 法律、版权及其他声明
项目开源，涉及到开源软件的证书问题，参考

[Choosing the right license](https://help.github.com/articles/licensing-a-repository/#disclaimer)

[Opensource legal guide](https://opensource.guide/legal/)
#### 3.3.8 适用的标准
-   MVVM设计模型
-   不使用瀑布模型（划掉）
-   待添加

### 3.4 系统模型
本节使用UML中的概念、方法和模型图来详细表达需求。
#### 3.4.1场景
##### <场景一>
-   场景名字：用户登录
-   参与者实例：用户
-   事件流程：
1.  用户在Android平台登录本系统，进入用户登录界面，输入用户名、密码等身份信息，并提交
2.  服务器接受信息，核对或注册，完成数据库更新，反馈登录成功
    
##### <场景二>
-   场景名字：用户修改个性化音频
-   参与者实例：用户
-   事件流程：
1.  用户在界面中选择需要修改、添加或删除的音频文件，并提交
2.  服务器接受，核对并更新数据库，反馈
    
##### <场景三>
-   场景名字：用户进入音频播发
-   参与者实例：用户
-   事件流程：
1.  用户在界面中开始播放
2.  服务器接受，缓存用户的空间音频
3.  本地系统调用可用传感器，对用户位置和头部动态进行确定，发送至服务器
4.  服务器接受，反馈音频播放方法
5.  本地系统接受，向用户立体声播放

#### 3.4.2用例模型

#### 3.4.3用户界面
